<br/>

<h1 class="ui header">
    <i class="mail icon"></i>

    <div class="content" style="position: relative; bottom: -5px">
        Mensagens
    </div>
</h1>

<div class="ui fitted divider"></div>

<br/>

<div style="overflow: auto !important; max-width: 100%;">
    <table class="ui table selectable very basic small unstackable" style="white-space: nowrap !important;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Conteúdo</th>
                <th>Usuário orig.<br/>Usuário dest.</th>
                <th>Bot <br/> Sequência</th>
                <th>Tipo</th>
                <th>Favoritada<br/>Compartilhamentos</th>
                <th>Visualizado<br/>Visualizações</th>                
                <th>
                    Tempo tot. de Foco <br/>
                    Polaridade Emocional
                </th>

                <th class="collapsing">
                    <div class="ui button icon" modal="modal_entities_search">
                        <i class="icon search"></i>
                    </div>
                </th>
            </tr>
        </thead>

        <tbody>
            <% View::Message.order('id, interaction_ids').all.each do |m| %>
              <tr>
                  <td style="font-size: 90%;">
                      <b><%= m.id %></b>
                  </td>



                  <td style="max-width: 200px !important;">
                      <div class="text-overflow">
                          <b>
                              <%= m.type_content_acronym_name %>:
                          </b>

                          <%= m.content %>                   
                      </div>

                      <div style="font-size: 90%; color: grey; margin: 5px;">
                          <%= m.created_at %>
                      </div>
                  </td>

                  <td>
                      <% if m.destiny_user_id %>
                        <% if m.origin_user_id == 0 %>
                          Pesquisador
                        <% else %>
                          <%= user_origin_name %>
                        <% end %>
                      <% else %>
                        <div style="color: grey; font-size: 90%;">
                            Msg. de Bot
                        </div>
                      <% end %>

                      <% if m.destiny_user_id %>
                        <% if m.destiny_user_id == 0 %>
                          Pesquisador
                        <% else %>
                          <%= destiny_user_name %>
                        <% end %>
                      <% else %>
                        <div style="color: grey; font-size: 90%;">
                            Msg. de Bot
                        </div>
                      <% end %>
                  </td>

                  <td>
                      <% if m.interaction_id %>
                        <%= m.interaction_name %>
                        <% if m.interaction_ids %>
                          <br/> Sequência: <%= m.interaction_ids %>
                        <% end %>
                      <% else %>
                        <% if !m.reference_interaction_id %>
                          <div style="color: grey; font-size: 90%;">
                              Não vinculada a Bot
                          </div>
                        <% else %>
                          <div style="color: grey; font-size: 90%;">
                              Referente ao Bot
                              <b>
                                  <%= m.reference_interaction_name %>
                              </b>
                          </div>
                        <% end %>
                      <% end %>
                  </td>

                  <td style="font-size: 90%; color: grey;">
                      <%= m.type_acronym_name %>
                  </td>

                  <td>
                      <% if m.favorited %>
                        <i class="star yellow icon"></i>
                      <% else %>
                        <div style="color: grey;">
                            Não
                        </div>
                      <% end %>

                      <div>
                          <%= MessageShare.where(propagation_message_id: m.id).count %>
                      </div>
                  </td>

                  <td>
                      <div>
                          <% if m.count_views > 0 %>
                            <i class="green check icon"></i>
                          <% else %>
                            <span style="color: grey;">
                                Não
                            </span>
                          <% end %>
                      </div>

                      <%= m.count_views %>
                  </td>

                  <td>
                      <div>
                          <% if m.time_focus > 0 %>
                            <div style="color: #1b68a3;">
                                <%= '%.2f' % m.time_focus %>ms
                            </div>
                          <% else %>
                            <div style="color: grey;">
                                0.00ms
                            </div>
                          <% end %>
                      </div>

                      <% if m.sentimental_score == nil || m.sentimental_score == 0 %>
                        <div style="color: grey">
                            0
                        </div>
                      <% elsif m.sentimental_score < 0 %>
                        <div style="color: red; font-weight: bold;">
                            <%= '%.2f' % m.sentimental_score %>
                        </div>
                      <% else %>
                        <div style="color: green; font-weight: bold;">
                            <%= '%.2f' % m.sentimental_score %>
                        </div>
                      <% end %>
                  </td>

                  <td>
                      <div class="ui dropdown ws-center ">
                          <i class="icon ellipsis vertical grey" style="font-size: 20px;"></i>
                          <div class="menu">
                              <%= link_to '<i class="icon edit"></i> Editar'.html_safe, edit_researcher_interaction_path(m),
                                class: 'item'
                              %>

                                <%= link_to '<i class="icon delete"></i> Deletar'.html_safe, researcher_interaction_path(m),
                                  method: :delete,
                                  class: 'item',
                                    data: { confirm: 'Tem certeza?' }
                                %>
                              </div>
                          </div>
                      </td>
                  </tr>
                <% end %>
            </tbody>
        </table>
    </div>