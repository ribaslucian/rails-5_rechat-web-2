<div style="overflow: auto !important; max-width: 100%;">
    <table class="ui table selectable very basic large unstackable">
        <thead>
            <tr>
                <th>Título</th>
                <th>Cadastro</th>
                <th>Status</th>
                <th>Tot. Mensagens</th>
                <th>Tot. de <br/> Visualizações</th>
                <th>Tempo tot. de Foco</th>
                <th>
                    Favoritadas &<br/>
                    Compartilhamentos
                </th>
                <th>Média Emocional</th>
            </tr>
        </thead>

        <tbody>
            <% @interactions.each do |i| %>
              <tr>
                  <td>
                      <b>
                          <%= i.name %>
                      </b>
                  </td>

                  <td>
                      <%= i.created_at %>
                  </td>

                  <td>
                      <%= Acronym.find(i.status_acronym_id).name %>
                  </td>

                  <td>
                      <%= i.messages.count %>
                  </td>

                  <td>
                      <i class="icon eye grey"></i>

                      <% count_views = Message.sql("
    SELECT sum(count_views)
    FROM messages
    WHERE interaction_id = '#{i.id}'
    AND destiny_user_id IS NOT NULL
                      ").first['sum(count_views)'] %>

                      <%= count_views ? count_views : 0 %>
                  </td>

                  <td>
                      <% time_focus = Message.sql("SELECT sum(time_focus) FROM messages WHERE interaction_id = '#{i.id}'").first['sum(time_focus)'] %>

                      <% if time_focus != nil && time_focus > 0 %>
                        <div>
                            <%= '%.2f' % time_focus %>ms
                        </div>
                      <% else %>
                        <div>
                            0.00ms
                        </div>
                      <% end %>
                  </td>

                  <td>
                      <% stars = Message.where(interaction_id: i.id, favorited: true).count %>
                      <% shares = MessageShare.where(interaction_id: i.id).count %>

                      <% if stars > 0 %>
                        <div>
                            <i class="icon star"></i>
                            <%= stars %>
                        </div>
                      <% else %>
                        <div>
                            <i class="icon star"></i>
                            0
                        </div>
                      <% end %>

                      &nbsp;&nbsp;

                      <% if shares > 0 %>
                        <div>
                            <i class="icon share"></i>
                            <%= stars %>
                        </div>
                      <% else %>
                        <div>
                            <i class="icon share"></i>
                            0
                        </div>
                      <% end %>
                  </td>

                  <td>


                      <% bot_sum_polarity = Message.sql("
    SELECT sum(sentimental_score)
    FROM messages
    WHERE interaction_id = '#{i.id}'
    AND destiny_user_id IS NULL
                      ").first['sum(sentimental_score)'] %>

                      <% bot_total_alvos = Message.sql("
    SELECT count(*)
    FROM messages
    WHERE interaction_id = '#{i.id}'
    AND destiny_user_id IS NULL
    AND type_acronym_id = 2
                      ").first['count(*)'] %>

                      <% bot_avg = (bot_total_alvos != 0 && bot_total_alvos != nil && bot_sum_polarity != nil) ? (bot_sum_polarity/bot_total_alvos) : 0%>

                      <div>
                          <% if bot_avg < 0 %>
                            <div class="ui label red">
                                Bot: <%= '%.2f' % bot_avg %>
                            </div>
                          <% elsif bot_avg == 0 %>
                            <div class="ui label grey">
                                Bot: 0
                            </div>
                          <% else %>
                            <div class="ui label green">
                                Bot: <%=  '%.2f' % bot_avg %>
                            </div>
                          <% end %>
                      </div>





                      <% responses_sum_polarity = Message.sql("
    SELECT sum(sentimental_score)
    FROM messages
    WHERE reference_interaction_id = '#{i.id}'
    AND destiny_user_id = 0
                      ").first['sum(sentimental_score)'] %>

                      <% responses_total_alvos = Message.sql("
    SELECT count(*)
    FROM messages
    WHERE reference_interaction_id = '#{i.id}'
    AND destiny_user_id = 0
                      ").first['count(*)'] %>

                      <% responses_avg = (responses_total_alvos != 0 && responses_total_alvos != nil && responses_sum_polarity != nil) ? (responses_sum_polarity/responses_total_alvos) : 0%>

                      <div>
                          <% if responses_avg < 0 %>
                            <div class="ui label red">
                                <i class="icon heart"></i>
                                Respostas: <%= '%.2f' % responses_avg %>
                            </div>
                          <% elsif responses_avg == 0 %>
                            <div class="ui label grey">
                                <i class="icon heart"></i>
                                Respostas: 0
                            </div>
                          <% else %>
                            <div class="ui label green">
                                <i class="icon heart"></i>
                                Respostas: <%= '%.2f' % responses_avg %>
                            </div>
                          <% end %>
                      </div>
                  </td>
              </tr>
            <% end %>
        </tbody>
    </table>
</div>